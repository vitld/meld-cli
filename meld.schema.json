{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "meld.jsonc",
  "description": "Configuration for the meld agent settings generator",
  "type": "object",
  "required": ["projects", "agents", "mcp", "ide"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference (auto-generated by meld)"
    },
    "projects": {
      "type": "object",
      "description": "Registered projects in this workspace",
      "additionalProperties": {
        "type": "object",
        "required": ["path", "aliases"],
        "properties": {
          "path": { "type": "string", "description": "Absolute or ~-relative path to the project" },
          "aliases": { "type": "array", "items": { "type": "string" }, "description": "Natural language names for the project" },
          "repo": { "type": "string", "description": "GitHub repository (org/repo, optional)" },
          "readDocs": { "type": "boolean", "description": "Instruct agents to read the project's context file before starting work" }
        }
      }
    },
    "agents": {
      "type": "object",
      "description": "Agent configurations â€” enable/disable and set overrides per agent",
      "properties": {
        "claude-code": { "$ref": "#/definitions/agentConfig" },
        "codex-cli": { "$ref": "#/definitions/agentConfig" },
        "gemini-cli": { "$ref": "#/definitions/agentConfig" }
      },
      "additionalProperties": false
    },
    "mcp": {
      "type": "object",
      "description": "MCP server configurations",
      "additionalProperties": {
        "oneOf": [
          { "$ref": "#/definitions/mcpStdioServer" },
          { "$ref": "#/definitions/mcpHttpServer" }
        ]
      }
    },
    "context": {
      "type": "string",
      "description": "Path to context directory containing .md files. Default: ./context/",
      "default": "./context/"
    },
    "ide": {
      "type": "object",
      "required": ["default", "workspaceName"],
      "properties": {
        "default": { "type": "string", "enum": ["cursor", "code", "windsurf"] },
        "workspaceName": { "type": "string" }
      }
    }
  },
  "definitions": {
    "agentName": {
      "type": "string",
      "enum": ["claude-code", "codex-cli", "gemini-cli"]
    },
    "agentConfig": {
      "type": "object",
      "required": ["enabled"],
      "properties": {
        "enabled": { "type": "boolean", "description": "Enable config generation for this agent" },
        "dir": { "type": "string", "description": "Custom subdirectory name for this agent's generated files (defaults to agent-specific name)" },
        "overrides": { "type": "object", "description": "Agent-specific raw config overrides merged into generated settings", "additionalProperties": true }
      }
    },
    "mcpStdioServer": {
      "type": "object",
      "required": ["command", "args"],
      "properties": {
        "type": { "type": "string", "enum": ["stdio"], "description": "Server type (default: stdio)" },
        "command": { "type": "string", "description": "Command to start the server" },
        "args": { "type": "array", "items": { "type": "string" }, "description": "Command arguments" },
        "env": { "type": "object", "additionalProperties": { "type": "string" }, "description": "Environment variables" },
        "agents": { "type": "array", "items": { "$ref": "#/definitions/agentName" }, "description": "Scope this server to specific agents (defaults to all enabled)" }
      }
    },
    "mcpHttpServer": {
      "type": "object",
      "required": ["type", "url"],
      "properties": {
        "type": { "type": "string", "enum": ["http"], "description": "Server type" },
        "url": { "type": "string", "description": "MCP server URL" },
        "headers": { "type": "object", "additionalProperties": { "type": "string" }, "description": "HTTP headers (e.g. Authorization)" },
        "env": { "type": "object", "additionalProperties": { "type": "string" }, "description": "Environment variables" },
        "agents": { "type": "array", "items": { "$ref": "#/definitions/agentName" }, "description": "Scope this server to specific agents (defaults to all enabled)" }
      }
    }
  }
}
